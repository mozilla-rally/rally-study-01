# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.

# This file defines the metrics that are recorded by the Glean SDK.
# APIs to use these pings are automatically generated at build time using
# the `glean_parser` PyPI package.

# Metrics in this file may make use of SDK reserved ping names. See
# https://mozilla.github.io/glean/book/dev/core/internal/reserved-ping-names.html
# for additional information.

---
$schema: moz://mozilla.org/schemas/glean/metrics/2-0-0

rally:
  id:
    type: uuid
    lifetime: user
    send_in_pings:
      - study-enrollment
      - deletion-request
      - rs01-event
    description: |
      The id of the Rally client. This is generated by
      the Rally Core Add-on. A value of 00000000-0000-0000-0000-000000000000
      indicates a test payload. A value of 11111111-1111-1111-1111-111111111111
      indicates that the Rally id was not properly set.
    bugs:
      - https://github.com/mozilla-rally/rally-core-addon/issues/117
    data_reviews:
      - https://github.com/mozilla-rally/rally-core-addon/pull/505#issuecomment-815826426
    notification_emails:
      - hulmer@mozilla.com
    expires: never

page:
  id:
    type: string
    lifetime: ping
    send_in_pings:
      - rs01-event
    description: |
      A unique ID associated with a page visit. Each
      page ID is 128-bit value, randomly generated with
      the Web Crypto API and stored as a hexadecimal
      string.
    bugs:
      - https://github.com/mozilla-rally/rally-study-01/issues/106
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1703279#c2
    notification_emails:
      - hulmer@mozilla.com
    expires: never

  origin:
    type: string
    lifetime: ping
    send_in_pings:
      - rs01-event
    description: |
      The origin of the URL associated with the page
      visit. Calculated by applying `new URL(url).origin`.
      See the documentation for
      [url.origin](https://developer.mozilla.org/en-US/docs/Web/API/URL/origin).
    bugs:
      - https://github.com/mozilla-rally/rally-study-01/issues/106
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1703279#c2
    notification_emails:
      - hulmer@mozilla.com
    expires: never

  referrer_origin:
    type: string
    lifetime: ping
    send_in_pings:
      - rs01-event
    description: |
      The origin of the referrer URL for the page
      loading in the tab.
    bugs:
      - https://github.com/mozilla-rally/rally-study-01/issues/106
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1703279#c2
    notification_emails:
      - hulmer@mozilla.com
    expires: never

  title:
    type: string
    lifetime: ping
    send_in_pings:
      - rs01-event
    description: |
      The contents of the title element in the head
      of the page.
    bugs:
      - https://github.com/mozilla-rally/rally-study-01/issues/106
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1703279#c2
    notification_emails:
      - hulmer@mozilla.com
    expires: never

  og_type:
    type: string
    lifetime: ping
    send_in_pings:
      - rs01-event
    description: |
      The `og:type` meta tag contents (e.g. `<meta type="og:type"
      contents="article" />`).
    bugs:
      - https://github.com/mozilla-rally/rally-study-01/issues/106
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1703279#c2
    notification_emails:
      - hulmer@mozilla.com
    expires: never

  og_description:
    type: string
    lifetime: ping
    send_in_pings:
      - rs01-event
    description: |
      The `og:description` meta tag contents (e.g. `<meta
      type="og:description" contents="..." />`). If this
      isn't supplied, then attempts to look at the meta
      description contents (e.g. `<meta name="description"
      content="...">`).
    bugs:
      - https://github.com/mozilla-rally/rally-study-01/issues/106
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1703279#c2
    notification_emails:
      - hulmer@mozilla.com
    expires: never

page.attention:
  max_relative_scroll_depth:
    type: quantity
    unit: percentage
    lifetime: ping
    send_in_pings:
      - rs01-event
    description: |
      The largest depth reach on the page, as a
      proportion of the total page height.
    bugs:
      - https://github.com/mozilla-rally/rally-study-01/issues/106
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1703279#c2
    notification_emails:
      - hulmer@mozilla.com
    expires: never

  max_pixel_scroll_depth:
    type: quantity
    unit: pixels
    lifetime: ping
    send_in_pings:
      - rs01-event
    description: |
      The largest scroll pixel depth reached on the page.
    bugs:
      - https://github.com/mozilla-rally/rally-study-01/issues/106
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1703279#c2
    notification_emails:
      - hulmer@mozilla.com
    expires: never

  scroll_height:
    type: quantity
    unit: pixels
    lifetime: ping
    send_in_pings:
      - rs01-event
    description: |
      The total scroll height of the page, taken
      from `document.documentElement.scrollHeight` at
      the same interval as the other scroll fields.
    bugs:
      - https://github.com/mozilla-rally/rally-study-01/issues/106
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1703279#c2
    notification_emails:
      - hulmer@mozilla.com
    expires: never

page.visit:
  start:
    type: datetime
    time_unit: millisecond
    lifetime: ping
    send_in_pings:
      - rs01-event
    description: |
      When did the page visit start.
    bugs:
      - https://github.com/mozilla-rally/rally-study-01/issues/106
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1703279#c2
    notification_emails:
      - hulmer@mozilla.com
    expires: never

  stop:
    type: datetime
    time_unit: millisecond
    lifetime: ping
    send_in_pings:
      - rs01-event
    description: |
      When did the page visit stop.
    bugs:
      - https://github.com/mozilla-rally/rally-study-01/issues/106
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1703279#c2
    notification_emails:
      - hulmer@mozilla.com
    expires: never

event:
  start:
    type: datetime
    time_unit: millisecond
    lifetime: ping
    send_in_pings:
      - rs01-event
    description: |
      Noting when the event started. If sent in a ping with
      reason `attention`, this field notes when an inactive tab with
      a page loaded in it has been given active focus
      or a new page loads in an already-active tab.
      If otherwise sent in a ping with reason `audio`, this
      field notes when an unmuted audio element began
      playing in the active tab.
    bugs:
      - https://github.com/mozilla-rally/rally-study-01/issues/106
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1703279#c2
    notification_emails:
      - hulmer@mozilla.com
    expires: never

  stop:
    type: datetime
    time_unit: millisecond
    lifetime: ping
    send_in_pings:
      - rs01-event
    description: |
      Noting when the event ended. If sent in a ping with
      reason `attention`, this field notes when a user closed
      the active tab, switched or closed the active window,
      or loaded a new page into the active tab which ends
      the current attention event. If otherwise sent in a ping
      with reason `audio`, this field notes when an unmuted
      audio element stopped playing in the active tab.
    bugs:
      - https://github.com/mozilla-rally/rally-study-01/issues/106
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1703279#c2
    notification_emails:
      - hulmer@mozilla.com
    expires: never

  duration:
    type: timespan
    time_unit: millisecond
    lifetime: ping
    send_in_pings:
      - rs01-event
    description: |
      How long the event occurred.
    bugs:
      - https://github.com/mozilla-rally/rally-study-01/issues/106
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1703279#c2
    notification_emails:
      - hulmer@mozilla.com
    expires: never

  termination_reason:
    type: string
    lifetime: ping
    send_in_pings:
      - rs01-event
    description: |
      The reason the userâ€™s attention switched to the
      current attention event (e.g. changed a tab,
      loaded a new URL in the currently-active tab,
      closed a tab, closed a window, created a new tab,
      created a new window, stopped playing audio).
    bugs:
      - https://github.com/mozilla-rally/rally-study-01/issues/106
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1703279#c2
    notification_emails:
      - hulmer@mozilla.com
    expires: never
